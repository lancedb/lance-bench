name: PR Benchmark Bot

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PR number in lance-format/lance"
        required: true
        type: number
      pr_sha:
        description: "PR commit SHA to benchmark"
        required: true
        type: string
      pr_repo:
        description: "Repository (org/repo format)"
        required: false
        type: string
        default: "lance-format/lance"

jobs:
  trigger-benchmarks:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger run-benchmarks workflow
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.SCHEDULER_GITHUB_TOKEN }}
          script: |
            const result = await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'run-benchmarks.yml',
              ref: 'main',
              inputs: {
                git_sha: '${{ inputs.pr_sha }}',
                pr_number: '${{ inputs.pr_number }}',
                pr_repo: '${{ inputs.pr_repo }}'
              }
            });

            console.log('Triggered run-benchmarks workflow');
            console.log('View at: https://github.com/${{ github.repository }}/actions/workflows/run-benchmarks.yml');
